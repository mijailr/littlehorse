"use strict";(self.webpackChunklh_site=self.webpackChunklh_site||[]).push([[4982],{2885:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>d,default:()=>h,frontMatter:()=>i,metadata:()=>c,toc:()=>a});var r=t(4848),s=t(8453);const i={},d="External Events and Interrupts",c={id:"concepts/external-events",title:"External Events and Interrupts",description:"Workflows must be able to respond to inputs from the outside world in order to be truly useful and dynamic. One of the tools that LittleHorse provides which allows you to do that is External Events.",source:"@site/docs/04-concepts/04-external-events.md",sourceDirName:"04-concepts",slug:"/concepts/external-events",permalink:"/docs/concepts/external-events",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:4,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Tasks",permalink:"/docs/concepts/tasks"},next:{title:"User Tasks",permalink:"/docs/concepts/user-tasks"}},o={},a=[{value:"Motivation",id:"motivation",level:2},{value:"Structure in the API",id:"structure-in-the-api",level:2},{value:"<code>ExternalEvent</code>",id:"externalevent",level:3},{value:"Using External Events",id:"using-external-events",level:2},{value:"<code>ExternalEvent</code> Nodes",id:"externalevent-nodes",level:3},{value:"Interrupts",id:"interrupts",level:3},{value:"Scoping",id:"scoping",level:2},{value:"Use Cases",id:"use-cases",level:5}];function l(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h5:"h5",li:"li",ol:"ol",p:"p",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h1,{id:"external-events-and-interrupts",children:"External Events and Interrupts"}),"\n",(0,r.jsxs)(n.p,{children:["Workflows must be able to respond to inputs from the outside world in order to be truly useful and dynamic. One of the tools that LittleHorse provides which allows you to do that is ",(0,r.jsx)(n.em,{children:"External Events."})]}),"\n",(0,r.jsxs)(n.p,{children:["In LittleHorse, an ",(0,r.jsx)(n.code,{children:"ExternalEventDef"})," is a Metadata Object that defines some event or activity occuring outside of the LittleHorse ",(0,r.jsx)(n.code,{children:"WfRun"}),". An ",(0,r.jsx)(n.code,{children:"ExternalEvent"})," is an Execution Object that represents the occurrence of such an event. Common use-cases for an External Event would be encapsulating a webhook from github when a new branch is pushed, or representing an event from DocuSign that is fired when a document is completed."]}),"\n",(0,r.jsxs)(n.p,{children:["An External Event can be recorded through the ",(0,r.jsx)(n.code,{children:"PutExternalEvent"})," gRPC call. This can be accomplished using clients in any of our SDK's or through the use of ",(0,r.jsx)(n.code,{children:"lhctl"}),". Future versions of LittleHorse will allow you to directly hook up a webhook or event streaming system (eg Kafka) to LittleHorse and send events in a hands-off manner."]}),"\n",(0,r.jsx)(n.h2,{id:"motivation",children:"Motivation"}),"\n",(0,r.jsxs)(n.p,{children:["Workflow engines aim to help automate business processes. Oftentimes, such business processes involve interacting with the outside world and ",(0,r.jsx)(n.em,{children:"listening"})," for things to happen outside of the workflow engine before making a decision about what to do next. That is precisely what an ",(0,r.jsx)(n.code,{children:"ExternalEvent"})," is for: while a ",(0,r.jsx)(n.code,{children:"TaskRun"})," allows a ",(0,r.jsx)(n.code,{children:"WfRun"})," to change the outside world, an ",(0,r.jsx)(n.code,{children:"ExternalEvent"})," allows a ",(0,r.jsx)(n.code,{children:"WfRun"})," to react to the outside world. Some common use-cases are to:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Integrate with asynchronous third-party API's."}),"\n",(0,r.jsxs)(n.li,{children:["Interrupt a ",(0,r.jsx)(n.code,{children:"WfRun"})," and cause some special handling logic to be executed."]}),"\n",(0,r.jsx)(n.li,{children:"Wait for a person to sign a document in DocuSign."}),"\n",(0,r.jsx)(n.li,{children:"Wait for a customer to respond to a text message using a callback from the Twilio API."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"structure-in-the-api",children:"Structure in the API"}),"\n",(0,r.jsxs)(n.p,{children:["Just as a ",(0,r.jsx)(n.code,{children:"TaskRun"})," is an instance of a ",(0,r.jsx)(n.code,{children:"TaskDef"}),", an ",(0,r.jsx)(n.a,{href:"/docs/api#externalevent",children:(0,r.jsx)(n.code,{children:"ExternalEvent"})})," is an instance of an ",(0,r.jsx)(n.a,{href:"/docs/api#externaleventdef",children:(0,r.jsx)(n.code,{children:"ExternalEventDef"})}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"ExternalEventDef"})," metadata object must be ",(0,r.jsx)(n.a,{href:"/docs/developer-guide/grpc/managing-metadata#externaleventdef",children:"created"})," before you can ",(0,r.jsxs)(n.a,{href:"/docs/developer-guide/grpc/posting-external-events",children:["post an ",(0,r.jsx)(n.code,{children:"ExternalEvent"})]}),". The ",(0,r.jsx)(n.code,{children:"ExternalEventDef"})," currently only contains a ",(0,r.jsx)(n.code,{children:"name"})," which denotes the type of the ",(0,r.jsx)(n.code,{children:"ExternalEvent"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"externalevent",children:(0,r.jsx)(n.code,{children:"ExternalEvent"})}),"\n",(0,r.jsxs)(n.p,{children:["An ",(0,r.jsx)(n.code,{children:"ExternalEvent"})," is created through the ",(0,r.jsx)(n.a,{href:"/docs/api#putexternalevent",children:(0,r.jsx)(n.code,{children:"rpc PutExternalEvent"})}),". Every ",(0,r.jsx)(n.code,{children:"ExternalEvent"})," has a ",(0,r.jsx)(n.code,{children:"WfRunId"})," associated with it, so an ",(0,r.jsx)(n.code,{children:"ExternalEvent"})," is sent to a specific ",(0,r.jsx)(n.code,{children:"WfRun"})," at creation time."]}),"\n",(0,r.jsxs)(n.p,{children:["An ",(0,r.jsx)(n.code,{children:"ExternalEvent"})," has a composite ID (see ",(0,r.jsx)(n.a,{href:"/docs/api#externaleventid",children:(0,r.jsx)(n.code,{children:"message ExternalEventId"})}),") consisting of:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["The ",(0,r.jsx)(n.code,{children:"wf_run_id"})," of the associated ",(0,r.jsx)(n.code,{children:"WfRun"})]}),"\n",(0,r.jsxs)(n.li,{children:["The ",(0,r.jsx)(n.code,{children:"name"})," of the ",(0,r.jsx)(n.code,{children:"ExternalEventDef"})]}),"\n",(0,r.jsxs)(n.li,{children:["A ",(0,r.jsx)(n.code,{children:"guid"})," which is unique to the"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Why the ",(0,r.jsx)(n.code,{children:"WfRunId"}),"? An ",(0,r.jsx)(n.code,{children:"ExternalEvent"})," is intended to affect the behavior of a ",(0,r.jsx)(n.code,{children:"WfRun"}),"; therefore, an ",(0,r.jsx)(n.code,{children:"ExternalEvent"})," must be correlated to a specific ",(0,r.jsx)(n.code,{children:"WfRun"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"ExternalEvent"}),"s have a payload (the field is called ",(0,r.jsx)(n.code,{children:"content"}),") which is simply a ",(0,r.jsx)(n.a,{href:"/docs/api#variablevalue",children:"`VariableValue"}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"using-external-events",children:"Using External Events"}),"\n",(0,r.jsxs)(n.p,{children:["An ",(0,r.jsx)(n.code,{children:"ExternalEvent"})," can be used in a ",(0,r.jsx)(n.code,{children:"WfRun"})," in two ways:"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["An ",(0,r.jsx)(n.a,{href:"/docs/developer-guide/wfspec-development/external-events",children:(0,r.jsx)(n.code,{children:"ExternalEventNode"})})," blocks a ",(0,r.jsx)(n.code,{children:"ThreadRun"})," and waits until an ",(0,r.jsx)(n.code,{children:"ExternalEvent"})," arrives before allowing the ",(0,r.jsx)(n.code,{children:"ThreadRun"})," to continue."]}),"\n",(0,r.jsxs)(n.li,{children:["An ",(0,r.jsx)(n.a,{href:"/docs/developer-guide/wfspec-development/interrupts",children:"Interrupt"})," stops a ",(0,r.jsx)(n.code,{children:"ThreadRun"}),' execution, runs an "interrupt handler" ',(0,r.jsx)(n.code,{children:"ThreadRun"}),", and then resumes the ",(0,r.jsx)(n.code,{children:"ThreadRun"})," once the interrupt handler completes."]}),"\n"]}),"\n",(0,r.jsxs)(n.h3,{id:"externalevent-nodes",children:[(0,r.jsx)(n.code,{children:"ExternalEvent"})," Nodes"]}),"\n",(0,r.jsxs)(n.p,{children:["One use for an ",(0,r.jsx)(n.code,{children:"ExternalEvent"})," is the ",(0,r.jsx)(n.a,{href:"/docs/api#externaleventnode",children:(0,r.jsx)(n.code,{children:"ExternalEventNode"})})," Node Type. When a ",(0,r.jsx)(n.code,{children:"ThreadRun"})," reaches an ",(0,r.jsx)(n.code,{children:"ExternalEventNode"}),", it will wait until an ",(0,r.jsx)(n.code,{children:"ExternalEvent"})," of the specified type (and with the correct ",(0,r.jsx)(n.code,{children:"wf_run_id"}),") arrives. The output of the ",(0,r.jsx)(n.code,{children:"NodeRun"})," is simply the payload of the ",(0,r.jsx)(n.code,{children:"ExternalEvent"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["An ",(0,r.jsx)(n.code,{children:"EXTERNAL_EVENT"})," node can have a timeout configured; this means that if the ",(0,r.jsx)(n.code,{children:"ExternalEvent"})," does arrive within X seconds after the ",(0,r.jsx)(n.code,{children:"ThreadRun"})," arrives at the node, then the NodeRun will fail with a ",(0,r.jsx)(n.code,{children:"TIMEOUT"})," exception."]}),"\n",(0,r.jsxs)(n.p,{children:["If the ",(0,r.jsx)(n.code,{children:"ExternalEvent"})," arrives before the ",(0,r.jsx)(n.code,{children:"ThreadRun"})," reaches the ",(0,r.jsx)(n.code,{children:"EXTERNAL_EVENT"})," Node, that's ok! The ",(0,r.jsx)(n.code,{children:"ThreadRun"})," will immediately pick up the ",(0,r.jsx)(n.code,{children:"ExternalEvent"})," and move on to the next ",(0,r.jsx)(n.code,{children:"Node"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["An ",(0,r.jsx)(n.code,{children:"ExternalEvent"})," gets correlated to one and only one ",(0,r.jsx)(n.code,{children:"NodeRun"}),". When posting an event, you can optionally specify a ",(0,r.jsx)(n.code,{children:"threadRunNumber"})," to ensure that the ",(0,r.jsx)(n.code,{children:"ExternalEvent"})," can only be assigned to a ",(0,r.jsx)(n.code,{children:"NodeRun"})," on that specific ",(0,r.jsx)(n.code,{children:"ThreadRun"}),"."]}),"\n",(0,r.jsx)(n.admonition,{type:"note",children:(0,r.jsxs)(n.p,{children:["If you configure an ",(0,r.jsx)(n.code,{children:"EXTERNAL_EVENT"})," node with the ExternalEventDef ",(0,r.jsx)(n.code,{children:"foo"}),", you cannot use the ",(0,r.jsx)(n.code,{children:"foo"})," external event def as an Interrupt Trigger elsewhere in the same ",(0,r.jsx)(n.code,{children:"WfSpec"}),"."]})}),"\n",(0,r.jsx)(n.h3,{id:"interrupts",children:"Interrupts"}),"\n",(0,r.jsxs)(n.p,{children:["In C and C++, you can register a handler function to handle an OS signal: when the signal is caught, the program gets interrupted and the interrupt handler is executed. In LittleHorse, you can handle an ",(0,r.jsx)(n.code,{children:"ExternalEvent"})," and trigger an Interrupt ",(0,r.jsx)(n.code,{children:"ThreadRun"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["When an ",(0,r.jsx)(n.code,{children:"ExternalEvent"})," is posted to a ",(0,r.jsx)(n.code,{children:"WfRun"}),", and a ",(0,r.jsx)(n.code,{children:"ThreadRun"})," has registered an Interrupt for that specific ",(0,r.jsx)(n.code,{children:"ExternalEventDef"}),", then the affected ",(0,r.jsx)(n.code,{children:"ThreadRun"})," is halted. Once the ",(0,r.jsx)(n.code,{children:"ThreadRun"})," is halted, then a new Child ",(0,r.jsx)(n.code,{children:"ThreadRun"})," (specifically, an Interrupt Handler) is created."]}),"\n",(0,r.jsxs)(n.p,{children:["Once the Interrupt Handler (Child) completes, the Interrupted Thread (Parent) is resumed. If the Interrupt Handler fails, then the Parent also fails with a ",(0,r.jsx)(n.code,{children:"CHILD_FAILED"})," exception. This error is unrecoverable."]}),"\n",(0,r.jsx)(n.h2,{id:"scoping",children:"Scoping"}),"\n",(0,r.jsxs)(n.p,{children:["Interrupts are registered at the ",(0,r.jsx)(n.code,{children:"ThreadSpec"})," level. Only one ",(0,r.jsx)(n.code,{children:"ThreadSpec"})," may register an Interrupt for a specific ",(0,r.jsx)(n.code,{children:"ExternalEventDef"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["When a ",(0,r.jsx)(n.code,{children:"ThreadRun"})," is Interrupted, it must first halt. As per the ",(0,r.jsx)(n.a,{href:"/docs/concepts/workflows#lifecycle",children:"WfRun Documentation"}),", a ",(0,r.jsx)(n.code,{children:"ThreadRun"})," is not considered ",(0,r.jsx)(n.code,{children:"HALTED"})," until all of its Children are ",(0,r.jsx)(n.code,{children:"HALTED"})," as well. Therefore, interrupting a ",(0,r.jsx)(n.code,{children:"ThreadRun"})," causes all of the Children of the Interrupted ",(0,r.jsx)(n.code,{children:"ThreadRun"})," to halt as well."]}),"\n",(0,r.jsxs)(n.p,{children:["The Interrupt Handler is a Child of the Interrupted Thread. Therefore, it has read/write access to all of the Interrupted Thread's ",(0,r.jsx)(n.code,{children:"Variable"}),"s."]}),"\n",(0,r.jsx)(n.h5,{id:"use-cases",children:"Use Cases"}),"\n",(0,r.jsx)(n.p,{children:"Interrupts may be used for various reasons, such as to:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Kill a running ",(0,r.jsx)(n.code,{children:"WfRun"})," and perform some cleanup action (such as notifying a customer) before making the Interrupted Thread fail."]}),"\n",(0,r.jsxs)(n.li,{children:["Update the value of some ",(0,r.jsx)(n.code,{children:"Variable"})," in a running ",(0,r.jsx)(n.code,{children:"WfRun"}),", such as to change contact info or add items to a shopping cart."]}),"\n",(0,r.jsxs)(n.li,{children:["Send heartbeats from an external system and allow the ",(0,r.jsx)(n.code,{children:"WfRun"})," to keep track of the last seen activity (such as when determining when to invalidate an access token due to inactivity)."]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>d,x:()=>c});var r=t(6540);const s={},i=r.createContext(s);function d(e){const n=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:d(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);